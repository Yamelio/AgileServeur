
<html>
  <head>
  <title>Choix des voeux</title>

    <meta charset="UTF-8"/>
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
  <script src='js/jquery-2.1.3.js'></script>

  <script>
  var api="http://localhost:8080/micheline/"
    var login = "guillaume.kleinpoort";
    var bienvenue = $("<p>Connecté en tant que "+ login+"</p>");
    var etudiants = "<ul class=\"list-group\">";
    var tmp="";
    var dejafait = $("<i> Vous avez déjà ajouté cette formation </i>");
    var ajoutermsg = $("<i> Formation ajouté à votre liste </i>");

    function contient(a, b) {
        return a.indexOf(b) >= 0;
    }
      function addVoeux(id) {
      $('#info').empty();



      if(tmp.indexOf(document.getElementsByTagName('table')[0].getElementsByTagName('tr')[id].cells[1].innerHTML) >= 0 ){

       dejafait.appendTo('#info');
      }
      else{
        tmp+=document.getElementsByTagName('table')[0].getElementsByTagName('tr')[id].cells[1].innerHTML+" ";
        etudiants = $("<li class=\"list-group-item\">"+document.getElementsByTagName('table')[0].getElementsByTagName('tr')[id].cells[1].innerHTML+" - " + document.getElementsByTagName('table')[0].getElementsByTagName('tr')[id].cells[0].innerHTML+"</li></ul>");
      etudiants.appendTo('#liste');
      ajoutermsg.appendTo('#info');

    }
  }

  var contenu = "<table class=\"table table-striped\"><thead><tr><th>Nom</th><th>Prenom</th><th>Login</th><th>Voeux</th></tr></thead><tbody>";
  //contenu+= "<tr class=\"info\"><td>IUT A</td><td>Licence Pro DA2I</td><<td>Lille</td><td><input type=submit id=1 onclick=\"addVoeux(this.id)\" value=\"Ajouter\"></td></tr>"
  

$(document).ready(function() {
  // Mettre ici les gestionnaires d'évènements pour les différents boutons
  bienvenue.appendTo('#nom_user');
   $('#type_form').hide();
   $('#mes_formation').hide();

  $('#ok_type').click(function (event) {
    $('#output').empty();
    var formation = $('#diplome').val();
    console.log(formation);
    var res = $("<p> Voici la liste des etudiants</p>");
  var listeformation = $(contenu);

    
       res.appendTo('#output');
       listeformation.appendTo('#output');
  });
    
     $('#faire_1').click(function (event) {
         $('#mes_formation').hide();
          $('#choix_formation').show();
          $('#type_form').show();


     });

    $('#etudiants_1').click(function (event) {
          $('#choix_formation').hide();
          $('#mes_formation').show();

     });

    $('#faire_2').click(function (event) {
         $('#mes_formation').hide();
          $('#choix_formation').show();
          $('#type_form').show();


     });

    $('#etudiants_2').click(function (event) {
          $('#choix_formation').hide();
          $('#mes_formation').show();

     });

    // pour démarrer sur la page de choix
  //$('#faire_1').trigger('click');
  //$('#faire_2').trigger('click');

 
 $('#etudiants_1').click(function (event) {
   $.ajax({
    url: api+"etudiant",
    type: "GET",
    dataType : "json",

    success: function( json ) {
      var liste="";

      for(var i in json){
        liste+="<li class=\"list-group-item\">"+json[i].nom+ " " +json[i].prenom+" - " + json[i].login+"</li>";
	liste+="<ol>";
		    $.ajax({
		    url: api+"voeux/"+login,
		    type: "GET",
		    dataType : "json",

		    success: function( json2 ) {
		      var liste="";

		      for(var i in json2){
			console.log("je suis ici");
			liste+="<li class=\"list-group-item\">"+json2[i].formaEtabl.feno+"</li>";
		
		      }
		    
		      
		    },
		    
		    error: function( xhr, status, errorThrown ) {
			alert( "Sorry, there was a problem!" );
			console.log( "Error: " + errorThrown );
			console.log( "Status: " + status );
			console.dir( xhr );
		    },
		    // Code to run regardless of success or failure
		    complete: function( xhr, status ) {
			console.log( "The request is complete!" );
		    }
		  });
	
      liste+="</ol>";

		
      }
      //console.log(liste);
    document.getElementById("liste").innerHTML = liste;
      
    },
    
    error: function( xhr, status, errorThrown ) {
        alert( "Sorry, there was a problem!" );
        console.log( "Error: " + errorThrown );
        console.log( "Status: " + status );
        console.dir( xhr );
    },
    // Code to run regardless of success or failure
    complete: function( xhr, status ) {
        alert( "The request is complete!" );
    }
  });
      
  });
//Attente requete etablissemen
 $('#ok_type').click(function (event) {
  var tri = $('#tri').val();

   $.ajax({
    url: api+"etudiant/",
    type: "GET",
    dataType : "json",

    success: function( json ) {    


          function sortByVoeux(key1, key2){  
      		 return key1.hasVoeu > key2.hasVoeu;  
  	  }  
          function sortByName(key1, key2){  
      		 return key1.nom > key2.nom;  
  	  }  

      if(tri === "Alphabetique"){
	      json.sort(sortByName);
	      console.log("alpha");
	}
      else if (tri ==="Voeux"){
		
              json.sort(sortByVoeux);
      	      console.log("voeux");
	}
	
      contenu =  "<table class=\"table table-striped\"><thead><tr><th>Nom</th><th>Prenom</th><th>Login</th><th>Voeux</th></tr></thead><tbody>";
      var cpt = 0;
      for(var i in json){
        console.log(json[i].feno);
        if(cpt%2 === 0){
           contenu+= "<tr class=\"info\"><td>"+json[i].nom + "</td><td>"+" "+json[i].prenom + "</td><td>" + json[i].login +"</td><td>"+json[i].hasVoeu+"</td></tr>";
        }
        else{
         contenu+= "<tr><td>"+json[i].nom + "</td><td> "+json[i].prenom + "</td><td>" + json[i].login +"</td><td>"+ json[i].hasVoeu+"</td></tr>";
        }
        cpt++;
      }
      contenu+="</table>";
      //console.log(liste);
    document.getElementById("output").innerHTML = contenu;
      
    },
    
    error: function( xhr, status, errorThrown ) {
        alert( "Sorry, there was a problem!" );
        console.log( "Error: " + errorThrown );
        console.log( "Status: " + status );
        console.dir( xhr );
    },
    // Code to run regardless of success or failure
    complete: function( xhr, status ) {
        console.log( "The request is complete!" );
    }
  });
      
  });
}); // end document.ready
    </script>

</head>
<body>
    <div id="nom_user"/>
    </div>

  <center>

    <div id="choix_formation"/>
      <h1> Gestion Etudiant </h1>

      <input id='faire_1' type='button' class="btn" name = 'submit' value="Lister etudiants">
      <input id='etudiants_1' type='button' class="btn" name = 'submit' value="tableaux">
    

      <div class="form-actions" style="margin:20px">
     
        <FORM>
          <div id="type_form">
            <label>Tri - </label>
            <SELECT name="tri" class="span2" id="tri" size="1">
             <OPTION>-</OPTION>
             <OPTION>Alphabetique</OPTION>
             <OPTION>Voeux</OPTION>
		
             <OPTION>Rang </OPTION>
             <OPTION>Rang (S1)</OPTION>
             <OPTION>Rang (S2)</OPTION>
             <OPTION>Rang (S3)</OPTION>
            </SELECT>
            <input id='ok_type' type='button' class="btn" name = 'submit' value="OK">
          </div>
        </FORM>

      </div>

      <div id="output"/></div>
      <div id="info"/></div>
    </div>

    <div id="mes_formation"/>
      <h1> Gestion d'etudiants </h1>
      <input id='faire_2' type='button' class="btn" name = 'submit' value="Lister etudiant">
      <input id='etudiants_2' type='button' class="btn" name = 'submit' value="Tableau des voeux">
      <div id="liste">

      </div>  
    </div>

  </center>

</body>
</html>
